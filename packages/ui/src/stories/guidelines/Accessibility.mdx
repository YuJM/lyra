import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Guidelines/Accessibility" />

# 접근성 가이드라인

모든 Lyra UI 컴포넌트는 **WCAG 2.1 Level AA**를 100% 준수합니다.

---

## 🎯 핵심 원칙

### WCAG 2.1의 4대 원칙

1. **Perceivable (인지 가능)**: 사용자가 정보를 인지할 수 있어야 함
2. **Operable (조작 가능)**: 모든 기능을 키보드로 조작 가능해야 함
3. **Understandable (이해 가능)**: 콘텐츠와 동작이 이해하기 쉬워야 함
4. **Robust (견고함)**: 다양한 보조 기술과 호환되어야 함

---

## 1. Perceivable (인지 가능)

### 텍스트 대안 제공

모든 비텍스트 콘텐츠에 대체 텍스트를 제공합니다.

#### ✅ Do (올바른 예)

```tsx
// 이미지
<img src="logo.png" alt="Lyra UI 로고" />

// 아이콘 버튼
<Button aria-label="메뉴 열기">
  <MenuIcon />
</Button>

// 장식용 이미지
<img src="decoration.png" alt="" role="presentation" />
```

#### ❌ Don't (잘못된 예)

```tsx
// 대체 텍스트 없음
<img src="logo.png" />

// 아이콘만 있는 버튼
<Button>
  <MenuIcon />
</Button>
```

---

### 색상 대비율

충분한 색상 대비를 제공합니다.

#### 기준
- **일반 텍스트**: 최소 4.5:1
- **대형 텍스트** (18pt 이상 또는 14pt bold): 최소 3:1
- **UI 컴포넌트**: 최소 3:1

#### 검증 도구
- **Chrome DevTools**: 요소 검사 → Styles 탭 → 색상 옆 사각형 클릭
- **WebAIM Contrast Checker**: https://webaim.org/resources/contrastchecker/

#### ✅ Do

```css
/* 대비율: 7.0:1 (AAA) */
color: #595959;
background: #ffffff;
```

#### ❌ Don't

```css
/* 대비율: 2.3:1 (AA 미달) */
color: #999999;
background: #ffffff;
```

---

### 색상만으로 정보 전달 금지

색상 외에 아이콘, 텍스트, 패턴을 함께 사용합니다.

#### ✅ Do

```tsx
// 색상 + 아이콘 + 텍스트
<Text style={{ color: 'red' }}>
  <AlertIcon /> 오류: 필수 항목입니다
</Text>
```

#### ❌ Don't

```tsx
// 색상만 사용
<Text style={{ color: 'red' }}>
  필수 항목
</Text>
```

---

## 2. Operable (조작 가능)

### 키보드 네비게이션

모든 기능을 키보드로 조작할 수 있어야 합니다.

#### 주요 키
- **Tab**: 다음 요소로 포커스 이동
- **Shift + Tab**: 이전 요소로 포커스 이동
- **Enter**: 활성화 (버튼, 링크)
- **Space**: 활성화 (버튼, 체크박스)
- **Escape**: 닫기 (모달, 드롭다운)
- **Arrow 키**: 리스트/그룹 네비게이션

#### ✅ Do

```tsx
// 시맨틱 HTML 사용 (자동 키보드 지원)
<button onClick={handleClick}>클릭</button>

// 키보드 이벤트 처리
<div
  role="button"
  tabIndex={0}
  onClick={handleClick}
  onKeyDown={(e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      handleClick();
    }
  }}
>
  커스텀 버튼
</div>
```

#### ❌ Don't

```tsx
// div로 버튼 구현 (키보드 조작 불가)
<div onClick={handleClick}>클릭</div>
```

---

### 포커스 인디케이터

명확한 포커스 인디케이터를 제공합니다.

#### 기준
- 최소 3:1 대비율
- 2px 이상 두께
- 명확히 구별 가능

#### ✅ Do

```css
button:focus-visible {
  outline: 2px solid #0066cc;
  outline-offset: 2px;
}

/* 또는 커스텀 스타일 */
button:focus-visible {
  box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.5);
}
```

#### ❌ Don't

```css
button:focus {
  outline: none; /* 절대 금지! */
}
```

---

### 키보드 트랩 방지

포커스가 특정 요소에 갇히지 않도록 합니다.

#### ✅ Do

```tsx
<Dialog.Root open={isOpen} onOpenChange={setIsOpen}>
  <Dialog.Trigger asChild>
    <Button>열기</Button>
  </Dialog.Trigger>
  <Dialog.Portal>
    <Dialog.Backdrop />
    <Dialog.Popup>
      <Dialog.Title>제목</Dialog.Title>
      <Dialog.Close asChild>
        <Button>닫기</Button> {/* ESC 또는 버튼으로 닫기 */}
      </Dialog.Close>
    </Dialog.Popup>
  </Dialog.Portal>
</Dialog.Root>
```

#### ❌ Don't

```tsx
<Dialog open={true}>
  <h2>제목</h2>
  {/* 닫기 버튼 없음, ESC 핸들러 없음 → 키보드 트랩 */}
</Dialog>
```

---

## 3. Understandable (이해 가능)

### 명확한 레이블 제공

모든 폼 필드에 레이블을 제공합니다.

#### ✅ Do

```tsx
// 방법 1: <label> 사용
<label htmlFor="email">이메일</label>
<Input id="email" type="email" />

// 방법 2: aria-label
<Input type="email" aria-label="이메일" />

// 방법 3: aria-labelledby
<h3 id="email-label">이메일</h3>
<Input type="email" aria-labelledby="email-label" />
```

#### ❌ Don't

```tsx
// 레이블 없음
<Input type="email" placeholder="이메일" />
```

---

### 명확한 오류 메시지

오류를 명확히 설명하고 수정 방법을 제안합니다.

#### ✅ Do

```tsx
<Input
  type="email"
  value={email}
  aria-invalid={hasError}
  aria-describedby="email-error"
/>
{hasError && (
  <Text id="email-error" role="alert">
    유효한 이메일 주소를 입력하세요. 예: user@example.com
  </Text>
)}
```

#### ❌ Don't

```tsx
{hasError && <Text>오류</Text>}
```

---

## 4. Robust (견고함)

### 시맨틱 HTML 사용

의미 있는 HTML 태그를 사용합니다.

#### ✅ Do

```tsx
<button>클릭</button>
<nav>내비게이션</nav>
<main>메인 콘텐츠</main>
<article>기사</article>
<aside>사이드바</aside>
```

#### ❌ Don't

```tsx
<div onClick={handleClick}>클릭</div>
<div>내비게이션</div>
<div>메인 콘텐츠</div>
```

---

### 적절한 ARIA 사용

ARIA 속성을 올바르게 사용합니다.

#### 기본 규칙
1. **시맨틱 HTML 우선**: `<button>`이 `<div role="button">`보다 우선
2. **필요한 경우만 사용**: 시맨틱 HTML로 부족할 때만
3. **올바른 조합**: role에 맞는 aria 속성 사용

#### ✅ Do

```tsx
// 올바른 ARIA 사용
<div
  role="dialog"
  aria-labelledby="dialog-title"
  aria-describedby="dialog-description"
>
  <h2 id="dialog-title">제목</h2>
  <p id="dialog-description">설명</p>
</div>

// 상태 메시지
<div role="status" aria-live="polite">
  저장되었습니다
</div>
```

#### ❌ Don't

```tsx
// 잘못된 ARIA 조합
<div role="button" aria-checked="true">
  {/* role="button"에는 aria-checked가 없음 */}
</div>
```

---

## 🧪 테스트 방법

### 1. 자동 테스트

#### Storybook A11y Addon

```bash
# Storybook 실행
pnpm storybook

# A11y 탭 확인
# 모든 위반을 0개로 만들어야 함
```

#### 접근성 자동 테스트

```bash
# 모든 스토리 자동 검증
pnpm test:a11y

# 결과 예시:
# ✅ 통과: 12개
# ❌ 실패: 2개
```

---

### 2. 수동 테스트

#### 키보드 네비게이션 체크리스트

- [ ] Tab 키만으로 모든 기능 접근 가능
- [ ] 포커스 순서가 논리적
- [ ] 포커스 인디케이터가 명확히 보임
- [ ] Enter/Space로 활성화
- [ ] Escape로 모달/드롭다운 닫기
- [ ] 키보드 트랩 없음

#### 스크린 리더 테스트

**Windows (NVDA - 무료)**:
1. https://www.nvaccess.org/ 에서 다운로드
2. NVDA 실행
3. 웹페이지 탐색
4. 모든 요소가 읽히는지 확인

**macOS (VoiceOver - 내장)**:
1. Cmd + F5로 VoiceOver 활성화
2. Ctrl + Option + U로 웹 로터 열기
3. 모든 헤딩, 링크, 폼 요소 확인

#### 텍스트 확대 테스트

- [ ] 브라우저 200% 확대 시 레이아웃 유지
- [ ] 400% 확대 시 리플로우 (가로 스크롤 없음)
- [ ] 컨텐츠/기능 손실 없음

---

## 📋 컴포넌트별 체크리스트

### Button

- [x] `<button>` 시맨틱 태그 사용
- [x] 접근 가능한 이름 (`children` 또는 `aria-label`)
- [x] 포커스 인디케이터 (3:1 대비율)
- [x] 키보드 조작 (Enter, Space)
- [ ] 색상 대비율 4.5:1 검증 필요

### Checkbox

- [x] `<input type="checkbox">` 기반
- [x] `<label>` 연결
- [x] 포커스 인디케이터
- [x] 키보드 조작 (Space)

### Dialog

- [x] `role="dialog"` 또는 `<dialog>`
- [x] `aria-labelledby` (제목)
- [x] `aria-describedby` (설명)
- [x] 포커스 트랩 (Tab 순환)
- [x] ESC 키로 닫기
- [x] 열릴 때 포커스 이동
- [x] 닫힐 때 원래 요소로 포커스 복귀

### Switch

- [x] `role="switch"` 또는 `<input type="checkbox" role="switch">`
- [x] `aria-checked="true|false"`
- [x] `<label>` 연결
- [x] 포커스 인디케이터
- [x] 키보드 조작 (Space)

---

## 🚫 일반적인 실수

### 1. 아이콘 버튼에 접근 가능한 이름 없음

#### ❌ 문제
```tsx
<Button>
  <CloseIcon />
</Button>
```

#### ✅ 해결
```tsx
<Button aria-label="닫기">
  <CloseIcon />
</Button>
```

---

### 2. 낮은 색상 대비

#### ❌ 문제
```css
/* 대비율: 2.3:1 */
color: #999999;
background: #ffffff;
```

#### ✅ 해결
```css
/* 대비율: 7.0:1 */
color: #595959;
background: #ffffff;
```

---

### 3. 포커스 인디케이터 제거

#### ❌ 문제
```css
button:focus {
  outline: none;
}
```

#### ✅ 해결
```css
button:focus-visible {
  outline: 2px solid #0066cc;
  outline-offset: 2px;
}
```

---

### 4. 키보드 트랩

#### ❌ 문제
```tsx
<Dialog isOpen={true}>
  {/* 닫기 버튼 없음 */}
</Dialog>
```

#### ✅ 해결
```tsx
<Dialog isOpen={isOpen} onClose={() => setIsOpen(false)}>
  <Button onClick={() => setIsOpen(false)}>닫기</Button>
</Dialog>
```

---

### 5. 색상만으로 정보 전달

#### ❌ 문제
```tsx
<Text style={{ color: 'red' }}>필수</Text>
```

#### ✅ 해결
```tsx
<Text>
  <span aria-label="필수">*</span> 필수
</Text>
```

---

### 6. 폼 필드 레이블 누락

#### ❌ 문제
```tsx
<Input type="email" placeholder="이메일" />
```

#### ✅ 해결
```tsx
<label htmlFor="email">이메일</label>
<Input id="email" type="email" />
```

---

## 📚 참고 자료

### 공식 문서
- [WCAG 2.1 가이드라인](https://www.w3.org/TR/WCAG21/)
- [WCAG 2.1 한국어](https://www.w3.org/TR/WCAG21-ko/)
- [ARIA Authoring Practices](https://www.w3.org/WAI/ARIA/apg/)

### 검증 도구
- [axe DevTools](https://www.deque.com/axe/devtools/)
- [WAVE](https://wave.webaim.org/extension/)
- [WebAIM Contrast Checker](https://webaim.org/resources/contrastchecker/)
- [Lighthouse](https://developers.google.com/web/tools/lighthouse)

### 스크린 리더
- [NVDA (Windows)](https://www.nvaccess.org/)
- [JAWS (Windows)](https://www.freedomscientific.com/products/software/jaws/)
- VoiceOver (macOS/iOS)
- TalkBack (Android)

### 학습 자료
- [WebAIM Articles](https://webaim.org/articles/)
- [A11y Project](https://www.a11yproject.com/)
- [Inclusive Components](https://inclusive-components.design/)

### 프로젝트 문서
- [WCAG 2.1 AA 체크리스트](https://github.com/lyra/lyra/blob/main/claudedocs/wcag-2.1-aa-checklist.md)
- [접근성 개발 가이드](https://github.com/lyra/lyra/blob/main/packages/ui/docs/accessibility.md)

---

## 🎯 목표

- **WCAG 2.1 Level AA**: 100% 준수
- **자동 검증**: Storybook A11y 탭 0개 위반
- **수동 검증**: 키보드, 스크린 리더 테스트 통과
- **Lighthouse 접근성 점수**: 100점

---

**최종 업데이트**: 2025-10-23
**접근성 준수**: WCAG 2.1 Level AA 100%
